DROP DATABASE village_green_ddb;
CREATE DATABASE village_green_ddb;
USE village_green_ddb;

CREATE TABLE Fournisseur(
   id_four INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
   adresse_four VARCHAR(50),
   nom_contact VARCHAR(30),
   prenom_contact VARCHAR(30),
   tel_contact VARCHAR(20),
   mail_contact VARCHAR(50),
   ref_produit VARCHAR(50),
   nom_produit VARCHAR(50)
);

CREATE TABLE Rubrique(
   id_rubrique INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
   code_rubrique VARCHAR(50),
   nom_rubrique VARCHAR(50)
);

CREATE TABLE Sous_Rubrique(
   id_sous_rubrique INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
   nom_sous_rubrique VARCHAR(50),
   code_sous_rubrique VARCHAR(50),
   id_rubrique INT NOT NULL,
   FOREIGN KEY(id_rubrique) REFERENCES Rubrique(id_rubrique)
);

CREATE TABLE Produit(
   ref_produit VARCHAR(10),
   nom VARCHAR(50),
   libelle VARCHAR(50),
   description TEXT,
   date_ajout DATETIME,
   tarif_ht DECIMAL(5,2),
   id_four INT NOT NULL,
   id_sous_rubrique INT NOT NULL,
   PRIMARY KEY(ref_produit),
   FOREIGN KEY(id_four) REFERENCES Fournisseur(id_four),
   FOREIGN KEY(id_sous_rubrique) REFERENCES Sous_Rubrique(id_sous_rubrique)
);

CREATE TABLE Employe(
   ref_employe VARCHAR(10),
   equipe VARCHAR(30),
   nom VARCHAR(30),
   prenom VARCHAR(30),
   adresse VARCHAR(255),
   code_postal VARCHAR(5),
   ref_employe_1 VARCHAR(10),
   PRIMARY KEY(ref_employe),
   FOREIGN KEY(ref_employe_1) REFERENCES Employe(ref_employe)
);

CREATE TABLE Client(
   id_cli INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
   nom VARCHAR(30),
   prenom VARCHAR(30),
   adresse_livraison VARCHAR(255),
   code_postal_livraison VARCHAR(5),
   adresse_facturation VARCHAR(255),
   code_postal_facturation VARCHAR(5),
   mdp_utilisateur VARCHAR(50),
   archive_cli VARCHAR(50),
   ref_employe VARCHAR(10) NOT NULL,
   FOREIGN KEY(ref_employe) REFERENCES Employe(ref_employe)
);

CREATE TABLE Banque_photo(
   id_photo INT PRIMARY KEY NOT NULL AUTO_INCREMENT,
   photo VARCHAR(255),
   ref_produit VARCHAR(10) NOT NULL,
   FOREIGN KEY(ref_produit) REFERENCES Produit(ref_produit)
);

CREATE TABLE Commande(
   id_commande VARCHAR(10),
   date_com DATE,
   num_bon_livraison VARCHAR(15),
   date_livraison VARCHAR(50),
   coef_cli DECIMAL(2,2),
   taux_tva VARCHAR(50),
   tarif_ttc DECIMAL(5,2),
   ref_employe VARCHAR(10) NOT NULL,
   id_cli INT NOT NULL,
   PRIMARY KEY(id_commande),
   FOREIGN KEY(ref_employe) REFERENCES Employe(ref_employe),
   FOREIGN KEY(id_cli) REFERENCES Client(id_cli)
);

CREATE TABLE achete(
   ref_produit VARCHAR(10),
   id_cli INT,
   PRIMARY KEY(ref_produit, id_cli),
   FOREIGN KEY(ref_produit) REFERENCES Produit(ref_produit),
   FOREIGN KEY(id_cli) REFERENCES Client(id_cli)
);

CREATE TABLE controle(
   ref_produit VARCHAR(10),
   id_commande VARCHAR(10),
   qt_produit INT,
   PRIMARY KEY(ref_produit, id_commande),
   FOREIGN KEY(ref_produit) REFERENCES Produit(ref_produit),
   FOREIGN KEY(id_commande) REFERENCES Commande(id_commande)
);
